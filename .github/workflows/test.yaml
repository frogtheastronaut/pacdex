name: Pacdex Test

on: [push, pull_request]

jobs:
  test-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Install Nix
        uses: cachix/install-nix-action@v30
        with:
          nix_path: nixpkgs=channel:nixos-24.05
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "22"
      - name: Install Python & Cargo
        run: |
          nix run nixpkgs#python3 -- --version
          sudo apt update
          sudo apt install -y python3-pip cargo
      - name: Test scanner
        run: npm link && pacdex

  test-mac:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "22"
      - name: Install Python & Cargo
        run: |
          brew install python rust
      - name: Test scanner
        run: npm link && pacdex

#   test-windows:
#     runs-on: windows-latest
#     steps:
#       - uses: actions/checkout@v3
#       - uses: actions/setup-node@v3
#         with:
#           node-version: "22"
#       - name: Install Python & Cargo
#         run: |
#           choco install python cargo -y
#       - name: Test Windows scanner
#         shell: pwsh
#         run: node .\src\scanners\scan_windows.js
